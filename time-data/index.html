<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<link href="select2-3.4.5/select2.css" rel="stylesheet"/>
<script src="select2-3.4.5/select2.js"></script>

<script src="hero_coefficients.js"></script>

<script src="Chart.js"></script>

<canvas id="myChart" width="400" height="400"></canvas>

<script>

	/* TODO:

		* Graph and select multiple heros (alternating colors and using
		  legend)
		* Graph line of average winrate for that char (color differences
		  above and below?)
		* Show as minutes
	*/


	function range(start, step, count) {
        return Array.apply(0, Array(count))
                    .map(function (element, index) {
                             return index * step + start;
                         });
    }

	function get_y_for_x(coefficients, x) {
		total = 0;
		for (var i = 0; i < coefficients.length; i++) {
			total += coefficients[i] * Math.pow(
				x, coefficients.length - i - 1);
		}
		return total;
	}

	var intervals = range(0.25, 0.01, 100);

	function make_chart(heroes_coefficients) {

		// Setup basic display settings
		var data = {
			// Labels
			labels : intervals.map(function (x) {
				if (x % 0.25 == 0) { return String(x) }
				else {
					return "";
				}}),

			// Data
			datasets : []
		}
		colors = [
			["rgba(220,220,220,0.5)", "rgba(220,220,220,1)"],
			["rgba(151,187,205,0.5)", "rgba(151,187,205,1)"],
			["rgba(34,53,73,0.5)", "rgba(34,53,73,1)"],
			["rgba(223,172,107,0.5)", "rgba(223,172,107,1)"]
		];

		// Load hero data
		for (var i = 0; i < heroes_coefficients.length; i++) {
			data.datasets.push({
				fillColor : colors[i][0],
				strokeColor : colors[i][1],
				pointColor : colors[i][2],
				pointStrokeColor : "#fff",
				data : intervals.map(function (x) {
					return get_y_for_x(heroes_coefficients[i], x); })
			});
		}

		// Draw the chart
		var ctx = document.getElementById("myChart").getContext("2d");
		new Chart(ctx).Line(data, {
			pointDot : false,

			// Scale
			scaleOverride : true,
			scaleSteps : 20,
			scaleStepWidth : 0.01,
			scaleStartValue : 0.4,
		});

	}
</script>

<h3>Hero Select</h3>
<select multiple id="hero_selector" style="width:300px"></select>

<script>
	// Setup fancy dropdown
	$('#hero_selector').select2();

	// Add hero options
	options = '';
	for (var hero in hero_coefficients) {
		options += "<option>" + hero + "</option>";
	}
	$('#hero_selector').html(options);

	// Update chart on new heros selected
	$('#hero_selector').on('change', function(e) {
		var selected = $('#hero_selector').val();
		var coefficients = [];
		for (var i = 0; i < selected.length; i++) {
			coefficients.push(hero_coefficients[selected[i]]);
		}
		make_chart(coefficients);
	});
</script>
